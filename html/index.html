<!doctype html>
<!--suppress JSUnresolvedReference -->
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title id="appName"></title>
    <meta name="author" content="Tien Dung Le">
    <!-- Fonts -->
    <!-- <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Chivo Mono"> -->
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="bootstrap-5.3.3-dist/css/bootstrap.css">
    <link rel="stylesheet" href="bootstrap-5.3.3-dist/css/styling.css">
    <!--suppress JSUnresolvedLibraryURL -->
    <link rel="stylesheet" href="bootstrap-5.3.3-dist/aos/aos-next/src/sass/aos.scss" />
    <link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
    <style>
        .wordSearchTable {
            border-collapse: collapse;
            font-size: 12px;
        }
        
        td {
            border: 1px solid #ccc;
            width: 20px;
            height:20px;
            text-align: center;
            line-height: 15px;
            margin: 0; 
        }
    </style>
</head>

<body>
<div>
    <div class="container-fluid custom-footer" data-aos="fade-down">
        <nav class="navbar navbar-expand-sm navbar-dark container">
            <a href="index.html" class="navbar-brand" ><img src="../asset/navBarIcon.png" width="200" height="70"></a>


            <!-- Create ticket to fix this, doesn't respone on click  -->
            
            <!--
                <button class="navbar-toggler collapsed d-flex d-lg-none flex-column justify-content-around" type="button"
                    data-bs-toggle="collapse" data-bs-target="#toggleMobileMenu" aria-controls="toggleMobileMenu"
                    aria-expanded="false" aria-label="Toggle navigation">
                    <span class="toggler-icon top-bar"></span>
                    <span class="toggler-icon middle-bar"></span>
                    <span class="toggler-icon bottom-bar"></span>

                </button> 
            -->
            


            <div class="collapse navbar-collapse" id="toggleMobileMenu">
                <ul class="navbar-nav ms-auto text-end">
                    <li>
                        <a class="nav-link" href="#">HOME</a>
                    </li>
                    <li>
                        <a class="nav-link" href="#leaderboard">LEADERBOARD</a>
                    </li>
                    <li>
                        <a class="nav-link" href="#profile" onclick="showProfile()"> PROFILE</a>
                    </li>
                    <li>
                        <a class="nav-link" href="#contact">SUPPORT</a>
                    </li>


                </ul>
            </div>
        </nav>
    </div>
    <div class="container-fluid custom-body" id="log-in">
        <div id="home" class="container-fluid text-center flex-column d-flex justify-content-center align-items-center"
            style="height: 100vh;">
            <h1 style="font-size: 5vw;">READY TO SEARCH?</h1>
            <h3 ID="readyHeader">THERE ARE # PLAYERS IN THE LOBBY</h3>
            <h4 >ENTER YOUR USERNAME TO START</h4>
            <form name="userForm">
                <div class="input-group mb-2 ">
                    <span class="input-group-text" id="basic-addon1">@</span>
                    <input id="username" name="fname" type="text" class="form-control" placeholder="EX: JOHNLEE123" aria-label="Username"
                        aria-describedby="basic-addon1">
                </div>
            </form>
            <a class="btn btn-primary justify-content-center btn-lg active" onclick=buttonclicked(1) role="button" aria-pressed="true">
                JOIN LOBBY
            </a>
            
        </div>
    </div>

    <div class="d-flex justify-content-center flex-column text-center h-auto pb-5 d-none" id="lobby">
        <h1>LOBBY</h1>
        
        <table class="container table table-light h5">
            <thead>
                <tr>
                    <td>USERNAME</td>
                    <td>READY STATUS</td>
                </tr>
            </thead>
            <tbody id="lobby-body">

            </tbody>
        </table>
        <a class="btn btn-primary justify-content-center btn-lg active" onclick=buttonclicked(2)
                role="button" aria-pressed="true">READY</a>
        <a class="btn btn-primary justify-content-center btn-lg active" onclick=startMatchmaking()
                role="button" aria-pressed="true">START GAME</a>
    </div>

    <div class="container-fluid custom-body h-auto d-none" id="game">
        <div id="home" class="container-fluid text-center d-flex justify-content-center align-items-center py-3" style="height: fit-content">
            <div class="container">
                <div class="py-3 justify-content-center text-center flex-column d-flex container" id="grid">
                    
                </div>
            </div>
            <div>
                <table class="h4 table table-light">
                    <tr class="h3">
                        <td id="playerOneName">@</td>
                        <td id="playerOneScore">1</td>
                        <td>VS</td>
                        <td id="playerOneScore">2</td>
                        <td id="playerTwoName">@</td>
                    </tr>
                </table>
                <p>FIND THE WORDS: <span id="wordList"></span></p>
                <!-- Multi-user chat box -->
                <div class="container-fluid">
                    <div class=" row justify-content-center">
                        <div class="col-md-8">
                            <div class="card">
                                <div class="card-header container-fluid">Chat</div>
                                <div class="card-body container-fluid" id="chatBox">
                                    <!-- Chat messages will be displayed here -->
                                </div>
                                <div class="card-footer container-fluid">
                                    <input type="text" class="form-control" id="chatMessage" placeholder="Type your message">
                                    <button class="btn btn-primary mt-2 container-fluid" id="sendMessage" onclick="sendChatMessage()">Send</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
        </div>
    </div>

    <!-- DO A FOR EACH LOOP TO DISPLAY THE PLAYERS IN THE LEADERBOARD -->
    <div data-aos="fade-up" class="d-flex justify-content-center flex-column text-center h-auto pb-5" id="leaderboard">
        <h1>LEADERBOARD</h1>
        
        <table class="container table table-light h5">
            <tr>
                <td>RANK</td>
                <td>PLAYER</td>
                <td>GAME WON</td>
            </tr>
            <tr>
                <td id="playerRank">1ST</td>
                <td id="playerName">@JOHNLEE123</td>
                <td id="playerGame"">12</td>
            </tr>
            <tr>
                <td id="playerRank">2ND</td>
                <td id="playerName">@JOHN123</td>
                <td id="playerGame"">10</td>
            </tr>
            <tr>
                <td id="playerRank">3RD</td>
                <td id="playerName">@JOHN123</td>
                <td id="playerGame"">10</td>
            </tr>
            <tr>
                <td id="playerRank">4TH</td>
                <td id="playerName">@JOHN123</td>
                <td id="playerGame"">10</td>
            </tr>
            <tr>
                <td id="playerRank">5TH</td>
                <td id="playerName">@JOHN123</td>
                <td id="playerGame"">10</td>
            </tr>
            <tr>
                <td id="playerRank">6TH</td>
                <td id="playerName">@JOHN123</td>
                <td id="playerGame"">10</td>
            </tr>
        </table>
    </div>

    <div class="container-fluid custom-body d-none" id="profile">
        <div id="home" class="container-fluid text-center flex-column d-flex justify-content-center align-items-center"
            style="height: 100vh;">
            <h1 style="font-size: 5vw;">PROFILE</h1>
            <h2 id="profile_username"> USERNAME: </h2>
            <h3 id="profile_games_won">GAMES WON: </h3>
            <h3 id="profile_games_lost">GAMES LOST: </h3>
            <a class="btn btn-primary justify-content-center btn-lg active" onclick="hideProfile()"
                role="button" aria-pressed="true" >HIDE</a>
        </div>
    </div>

    </div>

    <section data-aos="fade-up" id="contact">
        <div class="container-fluid custom-footer">
            <div class="container d-flex flex-wrap justify-content-between align-items-center custom-contact">
                <p class="display-1">CONTACT US:</p>
                <ul class="list-unstyled">
                    <li class=" display-5">
                        <a href=""
                            class=" text-decoration-none text-light custom-contact-link" target="_blank">CUSTOMER
                            SUPPORT</a>
                    </li>
                    <li class=" display-5">
                        <a href="#" class="text-decoration-none text-light custom-contact-link" target="_blank">+1 123
                            456 7890</a>
                    </li>

                    <li class=" display-5">
                        <a href="mailto:hello@tienl.dev" class=" text-decoration-none text-light custom-contact-link"
                            target="_blank">HELLO@GMAIL.COM</a>
                    </li>
                </ul>
            </div>
            <footer class="text-center py-3">
                <div>
                    <p>&copy; 2024 TIEN LE FOR GROUP 26. ALL RIGHTS RESERVED</p>
                </div>
            </footer>
        </div>
    </section>
</div>




    <script src="bootstrap-5.3.3-dist/js/bootstrap.js"></script>
    <script src="bootstrap-5.3.3-dist/js/js.js"></script>
    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>

    <script>AOS.init();</script>
    <!-- <script src="usernameValidation.js"></script> -->

    <script>
        class UserEvent{
            request;
            GameId;
            UserId;
            gamesWon;
            gamesLost;
            chatMessage;
            buttonId;
            color;
        }

        var colors = ["Red", "Green", "Blue", "Yellow", "Purple"];
        var GameId = 0;

        var connection = null;
        var serverUrl;

        serverUrl = "ws://" + window.location.hostname + `:${parseInt(window.location.port) + 100}`;
        connection = new WebSocket(serverUrl);
        
        connection.onopen = function (evt) {
            console.log("open");
        }

        // Received a broadcast from a different client
        connection.onmessage = function(evt){
            var msg;
            msg = evt.data;
            console.log("Message received: " + msg);
            let obj = JSON.parse(msg);

            if('timerButton' in obj){
                console.log("Client has received a timer button: " + obj.timerButton);
                const button = document.getElementById(obj.timerButton);
                
                button.style.background = "rgb(255,255,0)";
                button.style.border = "solid red";
            }

            if('error' in obj){
                alert(obj.user + "\n" + obj.error);
            }


            if('grid' in obj){ // Game sent from the server
                console.log(obj.grid);
                // Generate and display the word search
                document.getElementById("lobby").classList.add("d-none");
                let lobby = document.getElementById("lobby");
                lobby.innerHTML = "";
                document.getElementById("game").classList.remove("d-none");
                
                generateWordSearch(obj.grid);
                console.log(obj.grid);

                // Hide matchmaking form
                document.getElementById("lobby").classList.add("d-none");

                // Show game elements
                document.getElementById("game").classList.remove("d-none");

                
            }

            if('request' in obj){   // USER EVENTS
                if(obj.request == 1){

                    const logIn = document.getElementById("log-in");
                    logIn.classList.add("d-none");

                    const lobby = document.getElementById("lobby");
                    lobby.classList.remove("d-none");



                    const lobbyBody = document.getElementById("lobby-body");

                    if(lobbyBody != null){
                        lobbyBody.innerHTML = "";
                    }

                    let LobbyUsers = obj.LobbyUsers;
                    LobbyUsers.forEach(function(player){
                        
                        var row = lobbyBody.insertRow();
                        var name = row.insertCell(0);
                        var ready = row.insertCell(1);

                        name.textContent = player.user;
                        if(player.ready == false){
                            ready.textContent = "Not Ready";
                        } else{
                            ready.textContent = "Ready";
                        }
                    });

                } 
                
                if(obj.request == 3){   // Since request # is 3, a chatMessage is being sent from a client
                    console.log("Chat message received from broadcast: " + obj.chatMessage + "  From userid: " + obj.UserId);
                    const chatBox = document.getElementById("chatBox");

                    const para = document.createElement("p");
                    const node = document.createTextNode(obj.UserId + ":\n" + obj.chatMessage);
                    para.appendChild(node);
                    para.setAttribute("align", "left");
                    para.style.background = obj.color;
                    para.style.color = "white";

                    chatBox.appendChild(para);
                }

                if(obj.request == 4){   // Request # 4: Letter pressed.
                    console.log("Letter pressed by " + obj.UserId + ": " + obj.buttonId + ". Button color is " + obj.color);
                    const button = document.getElementById(obj.buttonId);
                    let completedButtons = [];
                    completedButtons = obj.completedButtons;
                    console.log("Passed in array of completed buttons: " + completedButtons);

                    if(completedButtons.length != 0){
                        for(let i = 0; i < completedButtons.length - 1; i++){
                            console.log("i = " + i);
                            let completedButton = document.getElementById(completedButtons[i]);

                            // Remove onclick functionality to stop processing the button
                            completedButton.disabled = true;
                            completedButton.style.background = obj.color;
                        }

                        const lastLetter = document.getElementById(completedButtons[completedButtons.length - 1]);
                        lastLetter.disabled = true;
                    }

                    if(button.style.background === obj.color.toLowerCase()){ // Button previously pressed
                        button.style.background = "white";
                    }
                    else{
                        button.style.background = obj.color.toLowerCase();  // New button
                        button.style.border = "";
                    }
                }
            }


            
        }

        function buttonclicked(value){
            U = new UserEvent;
            if(value == 1){
                let username = document.getElementById("username").value;
                this.UserId = username;
                this.gamesLost = 0;
                this.gamesWon = 0;
                U.UserId = username;
                U.request = 1;

                let index = (Math.floor(Math.random() * colors.length));
                let color = colors[index];
                colors.splice(index, 1);

                U.color = color;
                this.color = color;

                connection.send(JSON.stringify(U));
                /*
                
                const logIn = document.getElementById("log-in");
                logIn.classList.add("d-none");

                const lobby = document.getElementById("lobby");
                lobby.classList.remove("d-none");
                */
            } else if (value == 2){
                U.UserId = this.UserId;
                U.request = 2;
                connection.send(JSON.stringify(U));
            }
        }

        function sendChatMessage(){
            const inputBox = document.getElementById("chatMessage");
            let msg = inputBox.value;

            let limit = 40;

            if(msg == ""){
                alert("Enter a message: ");
            }
            else if(msg.length > limit){
                alert("Message exceeds " + limit + " character limit. Try again.");
            }
            else{
                const chatBox = document.getElementById("chatBox");

                const para = document.createElement("p");
                const node = document.createTextNode(this.UserId + ":\n" + msg);
                para.appendChild(node);
                para.setAttribute("align", "right");
                para.style.background = this.color.toLowerCase();
                para.style.color = "white";

                chatBox.appendChild(para);

                U = new UserEvent;
                U.request = 3;
                U.GameId = this.GameId;
                U.UserId = this.UserId;
                U.color = this.color;
                U.gamesWon = this.gamesWon;
                U.gamesLost = this.gamesLost;
                U.chatMessage = msg;

                connection.send(JSON.stringify(U)); 
                
                // Empty message box after "sending"
                inputBox.value = "";
            }
        }

        //document.getElementById("startMatchmakingBtn").addEventListener("click", startMatchmaking);

        function startMatchmaking() {
            // Hide matchmaking form
            /*
            document.getElementById("lobby").classList.add("d-none");

            // Show game elements
            document.getElementById("game").classList.remove("d-none");

            // Update player names
            document.getElementById("playerOneName").innerText = "@" + UserId.toUpperCase();
            document.getElementById("playerTwoName").innerText = "@opponent"; // Replace "opponent" with actual opponent's name
            */
            // Start matchmaking process or any other game initialization logic
            U = new UserEvent;
            U.request = 5;
            connection.send(JSON.stringify(U)); 
            U.gamesWon = 0;
            U.gamesLost = 0;

            connection.send(JSON.stringify(U));
            console.log("Player started the match: " + JSON.stringify(U));

        }

        function showProfile() {
            // Show profile elements
            document.getElementById("profile").classList.remove("d-none");
            document.getElementById("profile_username").innerText = "USERNAME: " + UserId.toUpperCase();
            document.getElementById("profile_games_won").innerText = "GAMES WON: " + gamesWon;
            document.getElementById("profile_games_lost").innerText = "GAMES LOST: " + gamesLost;

        }

        function hideProfile() {
            // Hide profile elements
            document.getElementById("profile").classList.add("d-none");
        }

    </script>

    <script>
        class Coordinate {
            constructor(row, col){
                this.row = row;
                this.col = col;
            }
        }
        

        function processLetter(button){
            let id = button.getAttribute('id');

            U = new UserEvent;
            U.request = 4;
            U.UserId = this.UserId;
            U.color = this.color;
            U.buttonId = id;

            console.log("this.color is : " + U.color);

            console.log("User pressed button. " + JSON.stringify(U) + " sent to server");

            connection.send(JSON.stringify(U));
        }
    </script>

    <script>
        const wordsToFind = ['apple', 'banana', 'cherry', 'grape', 'orange', 'pear', 'kiwi', 'peach', 'mango','melon' ];
        const gridSize = 20;
        const gridDiv = document.getElementById('grid');
        const wordListElement = document.getElementById('wordList');
        const letters = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";

        // Function to generate the word search grid
        function generateWordSearch(grid) {
            let n = 0;
            gridDiv.innerHTML = "";

            for (let i = 0; i < gridSize; i++) {
                const div = document.createElement("div");
                gridDiv.appendChild(div);

                for (let j = 0; j < gridSize; j++) {
                    const button = document.createElement("button");
                    button.textContent = grid[i][j];

                    button.setAttribute("id", `${n}`);
                    button.setAttribute("onclick", "processLetter(this)");

                    div.appendChild(button);

                    n++;
                }

            }
        }
    </script>
</body>

</html>
